{% extends "base.html" %}
{% load static %}

{% block page_header %}
    <div class="container header-container">
        <div class="row">
            <div class="col"></div>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div class="overlay"></div>
    <div class="container">
        <div class="row">
            <div class="col-12 col-md-6">
                <hr>
                <h2 class="logo-font mb-4">Edit Your Review</h2>
                <hr>
            </div>
        </div>

        <div class="row">
            <div class="col-12 col-md-6">
                {% if user.is_authenticated %}
                    <form method="POST" action="{% url 'edit_review' review.id %}" class="form mb-2" enctype="multipart/form-data">
                        {% csrf_token %}
                        <!-- Message form field -->
                        <p class="text-left mb-3 mt-0 user-input-p text-muted">
                            Review From:
                            <input disabled="disabled" class="user-input-display" type="text" value="{{ user }}" readonly>
                        </p>
                        <!-- Crispy review form -->
                        {{ form|crispy }}
                            {% if form.errors %}
                                <div class="alert alert-danger">
                                    <ul>
                                        {% for field in form %}
                                            {% if field.errors %}
                                                <li>{{ field.label }}: {{ field.errors|join:", " }}</li>
                                            {% endif %}
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endif %}
                        <div class="text-center">
                            <a class="btn btn-outline-black rounded-0" href="{% url 'products' %}">Cancel</a>
                            <button class="btn btn-black rounded-0" type="submit">Update Review</button>
                        </div>
                    </form>

                    <!-- Delete form -->
                    <p class="mt-3 mb-2">Or, if you want to delete your review, click the button below:</p>
                    <form method="POST" action="{% url 'delete_review' review.id %}" class="form mb-2">
                        {% csrf_token %}
                        <div class="text-center">
                            <button class="btn btn-danger rounded-0" type="submit">Delete Review</button>
                        </div>
                    </form>

                {% else %}
                    <!-- If user is not authenticated -->
                    <p class="mt-3 mb-2">Only registered users are allowed to leave reviews. If you wish to leave a review, please sign up first.</p>
                    <a class="btn btn-black rounded-0 mt-0" href="{% url 'account_signup' %}">Sign Up Here</a>
                    <br>
                    <!-- Message to log in if already registered -->
                    <p class="mt-3 mb-2">If you have registered already, you should log in to leave your review:</p>
                    <a class="btn btn-black rounded-0 mt-0" href="{% url 'account_login' %}">Log In Here</a>
                {% endif %}
            </div>            
        </div>
    </div>
{% endblock %}